# Exploiting a Weak Symmetric JWT Secret

**Platform**: TryHackMe  
**Category**: Web App  
**Technique**: JWT Token Offline Brute Forcing (HMAC-SHA256)  

---

## Objective
The objective is to exploit a weak symmetric secret used to sign a JSON Web Token (JWT) in order to recover the secret key. Once obtained, the attacker can forge a new token with escalated privileges (e.g., admin access) and retrieve the flag or protected resource.

---

## Background / Theory
This attack targets a weak implementation of JWT authentication, where the token is signed using a symmetric algorithm like HMAC-SHA256 and a low-entropy (easily guessable) secret. When JWTs use symmetric keys, both the server and any client generating or validating tokens share the same secret. If the secret is weak, an attacker can crack it offline by brute-forcing the token signature with tools like John the Ripper or Hashcat.

Once the secret is discovered, the attacker can modify the payload (e.g., set admin: 1) and re-sign the token with the same header and cracked secret, forging a valid token that grants unauthorized access.

---

## Steps

1. Go to Task 5 on https://tryhackme.com/room/jwtsecurity
2. Authenticate to the API to recieve the JWT by making a POST request using cURL: `curl -H 'Content-Type: application/json' -X POST -d '{ "username" : "user", "password" : "password4" }' http://10.10.237.99/api/v1.0/example4` or you can use Postman
3. Save the JWT as jtw.txt
4. Download a common JWT secret list from https://raw.githubusercontent.com/wallarm/jwt-secrets/master/jwt.secrets.list
5. Download and install John the Ripper password cracker from https://www.openwall.com/john/ 
   - See here for a JTR cheat sheet: https://github.com/lyudaio/cheatsheets/blob/main/security/tools/johntheripper.md
6. Open a command prompt and execute `john.exe --wordlist=jwt.secrets.list --format=HMAC-SHA256 "<jwt folder path>\jwt.txt"`
7. Execute `john.exe --show "<jwt folder path>\jwt.txt"` to reveal the cracked secret
8. Use Cyber Chef: https://gchq.github.io/CyberChef/ to forge a new admin token by adding the JWT Sign operation and adding the secret value you just cracked to the Private/Secret Key section, ```{"typ": "JWT", "alg": "HS256"}``` to the Header section, and ```{"username": "user", "admin": 1}``` to the Input section (for the payload of the JWT).
9.  Use this token to retrieve the THM flag by making a request to the API with the token using cURL: `curl -H 'Authorization: Bearer [JWT Token]' http://10.10.237.99/api/v1.0/example4?username=admin`

---

## Outcome
The attacker successfully cracks the JWT secret, forges a new token with administrative privileges, and uses it to access the protected API endpoint. This leads to retrieval of the THM flag, representing unauthorized access to sensitive data due to poor token signing practices.

---

## Mitigation
To prevent this kind of vulnerability:

- Use strong, high-entropy secrets: Generate long, random strings that are not based on common words or patterns.
- Avoid hardcoded or reused secrets: Use environment variables or secure secret management tools to handle secrets.
- Consider asymmetric signing (RS256): With asymmetric algorithms, the server uses a private key to sign tokens, and clients use the corresponding public key to verify them. This means the signing key is never exposed and cannot be brute-forced from the client side.
- Rate-limit authentication attempts: Though this attack is performed offline, combining rate-limiting with secure logging and alerting can help detect potential abuse.

---