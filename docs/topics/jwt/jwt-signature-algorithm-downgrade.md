# JWT Signature Algorithm Downgrade

**Platform**: TryHackMe  
**Category**: Web App  
**Technique**: JWT Signature Algorithm Downgrade  

---

#### Objective
Exploit a misconfigured JWT validation process (eg not denying the `None` algorithm) by downgrading the signing algorithm to None, thereby bypassing signature verification and forging an admin token to retrieve sensitive data (the flag).

---

#### Background / Theory
This attack targets a poor implementation of JWT signature validation. The JWT specification includes a None algorithm, which indicates that the token is unsigned. This was originally intended for trusted, internal use cases (e.g., server-to-server communication where authentication happens upstream). However, if a web application does not explicitly reject the None algorithm, an attacker can:

- Modify the JWT header to set "alg": "None"
- Omit the signature entirely
- Alter the payload (e.g., setting "admin": 1)

If the backend server uses a vulnerable JWT library or fails to enforce a strict list of accepted algorithms, it may accept the forged token as valid — completely bypassing signature verification.  

This is a logic flaw, not brute-force or injection — it exploits a misconfiguration or unsafe coding practice.

---

#### Steps

1. Go to Task 5 on https://tryhackme.com/room/jwtsecurity

2. Authenticate to the API to recieve the JWT by making a POST request using cURL: `curl -H 'Content-Type: application/json' -X POST -d '{ "username" : "user", "password" : "password3" }' http://10.10.237.99/api/v1.0/example3` or use Postman to make the request

3. Use Cyber Chef: https://gchq.github.io/CyberChef/ to forge a new admin token by:
   1. Adding the JWT Sign operation
   2. Setting the signing algorithm to None 
   3. pasting in the JWT payload into the Input and changing the admin property to 1:   
<img src="JWTSecurity/Task5-Downgrading-to-None.PNG" alt="" width="60%"/> 
   
4. Use the token generated by Cyber Chef to retrieve the THM flag by making a request to the API with the token using cURL: `curl -H 'Authorization: Bearer [JWT Token]' http://10.10.237.99/api/v1.0/example3?username=admin` or Postman

---

### Outcome

The attacker successfully bypasses signature verification, forges a token with elevated privileges (admin: 1), and retrieves sensitive data — in this case, the TryHackMe flag from the API endpoint.

---

### Mitigation

To prevent this issue:

- Explicitly define acceptable algorithms in your JWT decoding function:  
  - Example in Python: ```jwt.decode(token, secret, algorithms=["HS256", "HS384", "HS512"])```

- Reject the None algorithm unless it's part of a strictly controlled internal system.

- Avoid dynamically trusting the alg field in the JWT header.

- Use JWT libraries that disallow None by default when a secret is provided — for example, PyJWT will raise an exception if None is specified along with a secret.

- Always treat tokens as untrusted input — never rely on claims without verifying their authenticity. 

---